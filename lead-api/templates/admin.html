<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leads | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        dark: {
                            50: '#f9fafb',
                            100: '#f3f4f6',
                            200: '#e5e7eb',
                            300: '#d1d5db',
                            400: '#9ca3af',
                            500: '#6b7280',
                            600: '#4b5563',
                            700: '#374151',
                            800: '#1f2937',
                            900: '#111827',
                            950: '#0a0a0f',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        * {
            font-family: 'Inter', system-ui, sans-serif;
        }

        body {
            background: #09090b;
            color: #fafafa;
        }

        /* Subtle noise texture */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.015;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        /* Premium Card */
        .card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 16px;
        }

        .card-hover {
            transition: all 0.2s ease;
        }

        .card-hover:hover {
            background: rgba(255, 255, 255, 0.04);
            border-color: rgba(255, 255, 255, 0.1);
        }

        /* Stat Card Accent */
        .stat-accent {
            position: absolute;
            top: 0;
            left: 24px;
            right: 24px;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        }

        /* Premium Button */
        .btn-primary {
            background: #fafafa;
            color: #09090b;
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.15s ease;
        }

        .btn-primary:hover {
            background: #e4e4e7;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.06);
            color: #a1a1aa;
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.15s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fafafa;
            border-color: rgba(255, 255, 255, 0.15);
        }

        /* Table */
        .table-row {
            transition: background 0.15s ease;
        }

        .table-row:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        /* Status Pills */
        .status-success {
            background: rgba(34, 197, 94, 0.1);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .status-failed {
            background: rgba(239, 68, 68, 0.1);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        /* Avatar */
        .avatar {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        }

        /* Search */
        .search-input {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.2s ease;
        }

        .search-input:focus {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.2);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.05);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Modal */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: #18181b;
            border: 1px solid rgba(255, 255, 255, 0.08);
            animation: modalIn 0.2s ease;
        }

        @keyframes modalIn {
            from {
                opacity: 0;
                transform: scale(0.98) translateY(4px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Spinner */
        .spinner {
            width: 32px;
            height: 32px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-top-color: #fafafa;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Counter animation */
        .counter {
            font-variant-numeric: tabular-nums;
        }

        /* Kbd */
        kbd {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 2px 8px;
            font-size: 12px;
            font-family: 'JetBrains Mono', monospace;
            color: #71717a;
        }

        /* Divider */
        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.06), transparent);
        }

        /* Tabs */
        .tab-btn {
            position: relative;
        }

        .tab-active {
            color: #fafafa;
            border-color: #fafafa !important;
        }

        /* Date input */
        input[type="date"] {
            color-scheme: dark;
        }

        html:not(.dark) input[type="date"] {
            color-scheme: light;
        }

        /* Signed up badge */
        .status-signed-up {
            background: rgba(147, 51, 234, 0.1);
            color: #a855f7;
            border: 1px solid rgba(147, 51, 234, 0.2);
        }

        /* Callback scheduled badge */
        .status-callback {
            background: rgba(245, 158, 11, 0.1);
            color: #fbbf24;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        /* Active button states */
        button.btn-signed-up-active {
            background: rgba(147, 51, 234, 0.2);
            color: #c084fc;
            border: 1px solid rgba(147, 51, 234, 0.4);
            font-weight: 500;
        }

        button.btn-signed-up-active:hover {
            background: rgba(147, 51, 234, 0.3);
            color: #c084fc;
            border-color: rgba(147, 51, 234, 0.5);
        }

        button.btn-callback-active {
            background: rgba(245, 158, 11, 0.2);
            color: #fcd34d;
            border: 1px solid rgba(245, 158, 11, 0.4);
            font-weight: 500;
        }

        button.btn-callback-active:hover {
            background: rgba(245, 158, 11, 0.3);
            color: #fcd34d;
            border-color: rgba(245, 158, 11, 0.5);
        }

        /* Pagination */
        .pagination-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            transition: all 0.15s ease;
        }

        .pagination-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .pagination-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            color: #fafafa;
        }

        /* Sidebar active state */
        .nav-active {
            background: rgba(255, 255, 255, 0.06);
            color: #fafafa;
        }

        /* Chart tooltip */
        .chart-container {
            position: relative;
        }

        /* Light mode */
        html:not(.dark) body {
            background: #fafafa;
            color: #18181b;
        }

        html:not(.dark) .card {
            background: #ffffff;
            border-color: #e4e4e7;
        }

        html:not(.dark) .card-hover:hover {
            background: #fafafa;
            border-color: #d4d4d8;
        }

        html:not(.dark) .btn-primary {
            background: #18181b;
            color: #fafafa;
        }

        html:not(.dark) .btn-primary:hover {
            background: #27272a;
        }

        html:not(.dark) .btn-secondary {
            background: #f4f4f5;
            border-color: #e4e4e7;
            color: #52525b;
        }

        html:not(.dark) .search-input {
            background: #ffffff;
            border-color: #e4e4e7;
        }

        html:not(.dark) .table-row:hover {
            background: #f4f4f5;
        }

        html:not(.dark) .modal-content {
            background: #ffffff;
            border-color: #e4e4e7;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="flex">
        <!-- Sidebar -->
        <aside class="w-64 h-screen sticky top-0 border-r border-white/5 p-4 flex flex-col">
            <!-- Logo -->
            <div class="flex items-center gap-3 px-3 py-2 mb-8">
                <div class="w-8 h-8 rounded-lg bg-white flex items-center justify-center">
                    <svg class="w-4 h-4 text-black" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                </div>
                <span class="font-semibold text-[15px]">Broker Leads</span>
            </div>

            <!-- Navigation -->
            <nav class="space-y-1 flex-1">
                <a href="#" class="nav-active flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium">
                    <svg class="w-[18px] h-[18px] text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                    Dashboard
                    <span class="ml-auto text-xs bg-white/5 px-2 py-0.5 rounded-md font-mono" id="sidebarCount">0</span>
                </a>
            </nav>

            <!-- Bottom section -->
            <div class="space-y-1 pt-4 border-t border-white/5">
                <button onclick="toggleTheme()" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-zinc-500 hover:text-zinc-300 hover:bg-white/[0.02] transition-colors">
                    <svg id="themeIcon" class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                    </svg>
                    <span id="themeText">Light mode</span>
                    <kbd class="ml-auto">T</kbd>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 min-h-screen">
            <!-- Header -->
            <header class="sticky top-0 z-40 backdrop-blur-xl bg-[#09090b]/80 border-b border-white/5">
                <div class="px-8 py-4 flex items-center justify-between">
                    <div>
                        <h1 class="text-xl font-semibold">Dashboard</h1>
                        <p class="text-sm text-zinc-500 mt-0.5">Track and manage your leads</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="refreshLeads()" class="btn-secondary flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            Refresh
                        </button>
                        <button onclick="exportCSV()" class="btn-primary flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                            </svg>
                            Export
                        </button>
                    </div>
                </div>
            </header>

            <div class="p-8 space-y-8">
                <!-- Stats -->
                <div class="grid grid-cols-4 gap-4">
                    <div class="card p-6 relative overflow-hidden">
                        <div class="stat-accent"></div>
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-zinc-500 font-medium">Total Leads</p>
                                <p id="totalLeads" class="text-3xl font-semibold mt-2 counter">0</p>
                                <p class="text-xs text-zinc-600 mt-2">All time</p>
                            </div>
                            <div class="w-12 h-12 rounded-xl bg-blue-500/10 flex items-center justify-center">
                                <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-zinc-500 font-medium">Successful</p>
                                <p id="successfulLeads" class="text-3xl font-semibold mt-2 counter text-emerald-400">0</p>
                                <p class="text-xs text-emerald-500/60 mt-2 flex items-center gap-1">
                                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M7 14l5-5 5 5H7z"/></svg>
                                    <span id="successRate">0%</span> success rate
                                </p>
                            </div>
                            <div class="w-12 h-12 rounded-xl bg-emerald-500/10 flex items-center justify-center">
                                <svg class="w-6 h-6 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-zinc-500 font-medium">Failed</p>
                                <p id="failedLeads" class="text-3xl font-semibold mt-2 counter text-red-400">0</p>
                                <p class="text-xs text-zinc-600 mt-2">Needs attention</p>
                            </div>
                            <div class="w-12 h-12 rounded-xl bg-red-500/10 flex items-center justify-center">
                                <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="card p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-zinc-500 font-medium">This Week</p>
                                <p id="weeklyLeads" class="text-3xl font-semibold mt-2 counter">0</p>
                                <p class="text-xs text-zinc-600 mt-2">Last 7 days</p>
                            </div>
                            <div class="w-12 h-12 rounded-xl bg-violet-500/10 flex items-center justify-center">
                                <svg class="w-6 h-6 text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search & Table -->
                <div class="card overflow-hidden">
                    <!-- Tabs -->
                    <div class="border-b border-white/5">
                        <div class="flex">
                            <button id="tabAll" onclick="switchTab('all')" class="tab-btn tab-active px-6 py-3 text-sm font-medium border-b-2 border-white transition-colors">
                                All Leads
                                <span id="tabAllCount" class="ml-2 text-xs bg-white/10 px-2 py-0.5 rounded-full">0</span>
                            </button>
                            <button id="tabSignedUp" onclick="switchTab('signed_up')" class="tab-btn px-6 py-3 text-sm font-medium text-zinc-500 border-b-2 border-transparent hover:text-zinc-300 transition-colors">
                                Signed Up
                                <span id="tabSignedUpCount" class="ml-2 text-xs bg-white/10 px-2 py-0.5 rounded-full">0</span>
                            </button>
                            <button id="tabCallback" onclick="switchTab('callback')" class="tab-btn px-6 py-3 text-sm font-medium text-zinc-500 border-b-2 border-transparent hover:text-zinc-300 transition-colors">
                                Callback Scheduled
                                <span id="tabCallbackCount" class="ml-2 text-xs bg-white/10 px-2 py-0.5 rounded-full">0</span>
                            </button>
                        </div>
                    </div>

                    <!-- Filters Bar -->
                    <div class="p-4 border-b border-white/5">
                        <div class="flex items-center gap-4 flex-wrap">
                            <!-- Search -->
                            <div class="relative flex-1 min-w-[200px] max-w-md">
                                <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                </svg>
                                <input
                                    type="text"
                                    id="searchInput"
                                    placeholder="Search leads..."
                                    class="search-input w-full pl-10 pr-4 py-2.5 rounded-lg text-sm"
                                    onkeyup="handleSearch(event)"
                                >
                            </div>

                            <!-- Date Range -->
                            <div class="flex items-center gap-2">
                                <label class="text-xs text-zinc-500">From:</label>
                                <input
                                    type="date"
                                    id="startDate"
                                    class="search-input px-3 py-2 rounded-lg text-sm"
                                    onchange="applyFilters()"
                                >
                            </div>
                            <div class="flex items-center gap-2">
                                <label class="text-xs text-zinc-500">To:</label>
                                <input
                                    type="date"
                                    id="endDate"
                                    class="search-input px-3 py-2 rounded-lg text-sm"
                                    onchange="applyFilters()"
                                >
                            </div>

                            <!-- Clear Filters -->
                            <button onclick="clearFilters()" class="text-xs text-zinc-500 hover:text-zinc-300 transition-colors">
                                Clear filters
                            </button>
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-white/5">
                                    <th class="text-left text-xs font-medium text-zinc-500 uppercase tracking-wider px-6 py-4">Lead</th>
                                    <th class="text-left text-xs font-medium text-zinc-500 uppercase tracking-wider px-6 py-4">Contact</th>
                                    <th class="text-left text-xs font-medium text-zinc-500 uppercase tracking-wider px-6 py-4">Location</th>
                                    <th class="text-left text-xs font-medium text-zinc-500 uppercase tracking-wider px-6 py-4">Status</th>
                                    <th class="text-left text-xs font-medium text-zinc-500 uppercase tracking-wider px-6 py-4">Date</th>
                                    <th class="text-right text-xs font-medium text-zinc-500 uppercase tracking-wider px-6 py-4"></th>
                                </tr>
                            </thead>
                            <tbody id="leadsTableBody">
                                <!-- Leads inserted here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Loading -->
                    <div id="loadingState" class="hidden py-16 flex flex-col items-center justify-center">
                        <div class="spinner"></div>
                        <p class="text-sm text-zinc-500 mt-4">Loading leads...</p>
                    </div>

                    <!-- Empty -->
                    <div id="emptyState" class="hidden py-16 flex flex-col items-center justify-center">
                        <div class="w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4">
                            <svg class="w-8 h-8 text-zinc-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                            </svg>
                        </div>
                        <p class="text-sm font-medium text-zinc-400">No leads found</p>
                        <p class="text-xs text-zinc-600 mt-1">Leads will appear here once submitted</p>
                    </div>

                    <!-- Pagination -->
                    <div id="tableFooter" class="hidden px-6 py-4 border-t border-white/5">
                        <div class="flex items-center justify-between">
                            <span id="leadCount" class="text-sm text-zinc-500">0 leads</span>
                            <div class="flex items-center gap-2">
                                <button id="prevPage" onclick="goToPage(currentPage - 1)" class="pagination-btn" disabled>
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 19l-7-7 7-7"/>
                                    </svg>
                                </button>
                                <div id="pageNumbers" class="flex items-center gap-1">
                                    <!-- Page numbers inserted here -->
                                </div>
                                <button id="nextPage" onclick="goToPage(currentPage + 1)" class="pagination-btn" disabled>
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7"/>
                                    </svg>
                                </button>
                            </div>
                            <span class="text-xs text-zinc-600">Click on a row to view details</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Lead Modal -->
    <div id="leadModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeModal()"></div>
        <div class="relative z-10 flex items-center justify-center min-h-screen p-4">
            <div class="modal-content rounded-2xl w-full max-w-lg overflow-hidden">
                <div class="p-6 border-b border-white/5 flex items-center justify-between">
                    <h2 class="text-lg font-semibold">Lead Details</h2>
                    <button onclick="closeModal()" class="p-2 rounded-lg hover:bg-white/5 transition-colors">
                        <svg class="w-5 h-5 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div id="modalContent" class="p-6 max-h-[60vh] overflow-y-auto">
                    <!-- Content here -->
                </div>
                <div class="p-6 border-t border-white/5">
                    <div class="flex items-center gap-2 mb-4">
                        <button id="callbackBtn" onclick="toggleCallback()" class="btn-secondary flex-1 flex items-center justify-center gap-2 py-2.5">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                            </svg>
                            <span id="callbackBtnText">Callback Scheduled</span>
                        </button>
                        <button id="signupBtn" onclick="toggleSignup()" class="btn-secondary flex-1 flex items-center justify-center gap-2 py-2.5">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span id="signupBtnText">Mark as Signed Up</span>
                        </button>
                    </div>
                    <div class="flex justify-between items-center">
                        <button onclick="deleteLead()" class="text-sm text-red-400 hover:text-red-300 transition-colors">
                            Delete lead
                        </button>
                        <button onclick="closeModal()" class="btn-secondary">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div id="deleteModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeDeleteModal()"></div>
        <div class="relative z-10 flex items-center justify-center min-h-screen p-4">
            <div class="modal-content rounded-2xl w-full max-w-sm p-6 text-center">
                <div class="w-12 h-12 rounded-full bg-red-500/10 flex items-center justify-center mx-auto mb-4">
                    <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                </div>
                <h3 class="text-lg font-semibold mb-2">Delete this lead?</h3>
                <p class="text-sm text-zinc-500 mb-6">This action cannot be undone.</p>
                <div class="flex gap-3">
                    <button onclick="closeDeleteModal()" class="btn-secondary flex-1">Cancel</button>
                    <button onclick="confirmDelete()" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-medium py-2.5 px-4 rounded-lg text-sm transition-colors">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let currentLeadId = null;
        let currentLead = null;
        let allLeads = [];

        // Pagination state
        let currentPage = 1;
        const pageSize = 25;
        let totalLeads = 0;
        let totalPages = 1;

        // Filter state
        let currentTab = 'all'; // 'all' or 'signed_up'

        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadLeads();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
                closeDeleteModal();
            }
            if (e.key === 't' || e.key === 'T') {
                if (document.activeElement.tagName !== 'INPUT') {
                    toggleTheme();
                }
            }
        });

        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            document.getElementById('themeText').textContent = isDark ? 'Light mode' : 'Dark mode';
            document.getElementById('themeIcon').innerHTML = isDark
                ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>'
                : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>';
        }

        function animateValue(element, target) {
            const duration = 800;
            const start = parseInt(element.textContent) || 0;
            const startTime = performance.now();

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const eased = 1 - Math.pow(1 - progress, 3);
                element.textContent = Math.round(start + (target - start) * eased);
                if (progress < 1) requestAnimationFrame(update);
            }
            requestAnimationFrame(update);
        }

        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/api/stats`);
                const stats = await response.json();

                animateValue(document.getElementById('totalLeads'), stats.total_leads);
                animateValue(document.getElementById('successfulLeads'), stats.successful_leads);
                animateValue(document.getElementById('failedLeads'), stats.failed_leads);
                document.getElementById('sidebarCount').textContent = stats.total_leads;

                const rate = stats.total_leads > 0 ? Math.round((stats.successful_leads / stats.total_leads) * 100) : 0;
                document.getElementById('successRate').textContent = rate + '%';

                // Update tab counts
                document.getElementById('tabAllCount').textContent = stats.total_leads;
                document.getElementById('tabSignedUpCount').textContent = stats.signed_up_leads || 0;
                document.getElementById('tabCallbackCount').textContent = stats.callback_scheduled_leads || 0;

                // Calculate weekly (mock for now - would need backend support)
                document.getElementById('weeklyLeads').textContent = stats.total_leads;
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function loadLeads() {
            const tbody = document.getElementById('leadsTableBody');
            const loading = document.getElementById('loadingState');
            const empty = document.getElementById('emptyState');
            const footer = document.getElementById('tableFooter');

            tbody.innerHTML = '';
            loading.classList.remove('hidden');
            empty.classList.add('hidden');
            footer.classList.add('hidden');

            try {
                // Build URL with all filters
                const skip = (currentPage - 1) * pageSize;
                let url = `${API_BASE}/api/leads?skip=${skip}&limit=${pageSize}`;

                const search = document.getElementById('searchInput').value;
                if (search) url += `&search=${encodeURIComponent(search)}`;

                const startDate = document.getElementById('startDate').value;
                if (startDate) url += `&start_date=${startDate}`;

                const endDate = document.getElementById('endDate').value;
                if (endDate) url += `&end_date=${endDate}`;

                if (currentTab === 'signed_up') {
                    url += `&signed_up=true`;
                } else if (currentTab === 'callback') {
                    url += `&callback_scheduled=true`;
                }

                const response = await fetch(url);
                const data = await response.json();

                allLeads = data.leads;
                totalLeads = data.total;
                totalPages = Math.ceil(totalLeads / pageSize);

                loading.classList.add('hidden');

                if (data.leads.length === 0) {
                    empty.classList.remove('hidden');
                    updatePagination();
                    return;
                }

                footer.classList.remove('hidden');
                document.getElementById('leadCount').textContent = `Showing ${data.leads.length} of ${totalLeads} lead${totalLeads !== 1 ? 's' : ''}`;

                data.leads.forEach(lead => {
                    tbody.appendChild(createRow(lead));
                });

                updatePagination();
            } catch (error) {
                console.error('Error:', error);
                loading.classList.add('hidden');
            }
        }

        function updatePagination() {
            const prevBtn = document.getElementById('prevPage');
            const nextBtn = document.getElementById('nextPage');
            const pageNumbers = document.getElementById('pageNumbers');

            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;

            // Generate page numbers
            pageNumbers.innerHTML = '';

            if (totalPages <= 1) return;

            const maxVisible = 5;
            let start = Math.max(1, currentPage - Math.floor(maxVisible / 2));
            let end = Math.min(totalPages, start + maxVisible - 1);

            if (end - start < maxVisible - 1) {
                start = Math.max(1, end - maxVisible + 1);
            }

            if (start > 1) {
                pageNumbers.appendChild(createPageBtn(1));
                if (start > 2) {
                    const dots = document.createElement('span');
                    dots.className = 'px-2 text-zinc-600';
                    dots.textContent = '...';
                    pageNumbers.appendChild(dots);
                }
            }

            for (let i = start; i <= end; i++) {
                pageNumbers.appendChild(createPageBtn(i));
            }

            if (end < totalPages) {
                if (end < totalPages - 1) {
                    const dots = document.createElement('span');
                    dots.className = 'px-2 text-zinc-600';
                    dots.textContent = '...';
                    pageNumbers.appendChild(dots);
                }
                pageNumbers.appendChild(createPageBtn(totalPages));
            }
        }

        function createPageBtn(page) {
            const btn = document.createElement('button');
            btn.className = `pagination-btn ${page === currentPage ? 'active' : ''}`;
            btn.textContent = page;
            btn.onclick = () => goToPage(page);
            return btn;
        }

        function goToPage(page) {
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            loadLeads();
        }

        function switchTab(tab) {
            currentTab = tab;
            currentPage = 1;

            // Update tab styles
            document.getElementById('tabAll').classList.toggle('tab-active', tab === 'all');
            document.getElementById('tabAll').classList.toggle('text-zinc-500', tab !== 'all');
            document.getElementById('tabSignedUp').classList.toggle('tab-active', tab === 'signed_up');
            document.getElementById('tabSignedUp').classList.toggle('text-zinc-500', tab !== 'signed_up');
            document.getElementById('tabCallback').classList.toggle('tab-active', tab === 'callback');
            document.getElementById('tabCallback').classList.toggle('text-zinc-500', tab !== 'callback');

            loadLeads();
        }

        function applyFilters() {
            currentPage = 1;
            loadLeads();
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            currentPage = 1;
            loadLeads();
        }

        function createRow(lead) {
            const tr = document.createElement('tr');
            tr.className = 'table-row cursor-pointer border-b border-white/5 last:border-0';
            tr.onclick = () => viewLead(lead.id);

            const date = new Date(lead.submitted_at);
            const formattedDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
            const location = [lead.city, lead.state].filter(Boolean).join(', ') || '—';
            const isSuccess = lead.salesforce_status === 'success';
            const isSignedUp = lead.signed_up;
            const isCallback = lead.callback_scheduled;

            tr.innerHTML = `
                <td class="px-6 py-4">
                    <div class="flex items-center gap-3">
                        <div class="avatar w-9 h-9 rounded-full flex items-center justify-center text-xs font-semibold text-white">
                            ${lead.first_name[0]}${lead.last_name[0]}
                        </div>
                        <div>
                            <p class="font-medium text-sm">${lead.first_name} ${lead.last_name}</p>
                            <p class="text-xs text-zinc-500">${lead.gender || '—'}</p>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4">
                    <p class="text-sm font-mono">${formatPhone(lead.phone)}</p>
                    <p class="text-xs text-zinc-500 truncate max-w-[180px]">${lead.email || '—'}</p>
                </td>
                <td class="px-6 py-4">
                    <p class="text-sm text-zinc-400">${location}</p>
                </td>
                <td class="px-6 py-4">
                    <div class="flex items-center gap-2 flex-wrap">
                        <span class="inline-flex px-2.5 py-1 rounded-full text-xs font-medium ${isSuccess ? 'status-success' : 'status-failed'}">
                            ${isSuccess ? 'Success' : 'Failed'}
                        </span>
                        ${isCallback ? '<span class="inline-flex px-2.5 py-1 rounded-full text-xs font-medium status-callback">Callback</span>' : ''}
                        ${isSignedUp ? '<span class="inline-flex px-2.5 py-1 rounded-full text-xs font-medium status-signed-up">Signed Up</span>' : ''}
                    </div>
                </td>
                <td class="px-6 py-4">
                    <p class="text-sm text-zinc-500">${formattedDate}</p>
                </td>
                <td class="px-6 py-4 text-right">
                    <svg class="w-4 h-4 text-zinc-600 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7"/>
                    </svg>
                </td>
            `;
            return tr;
        }

        function formatPhone(phone) {
            if (!phone) return '—';
            const c = phone.replace(/\D/g, '');
            return c.length === 10 ? `(${c.slice(0,3)}) ${c.slice(3,6)}-${c.slice(6)}` : phone;
        }

        function viewLead(id) {
            currentLeadId = id;
            const lead = allLeads.find(l => l.id === id);
            if (!lead) return;

            currentLead = lead;

            const date = new Date(lead.submitted_at);
            const formattedDate = date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });

            // Update signup and callback button states
            updateSignupButton(lead.signed_up);
            updateCallbackButton(lead.callback_scheduled);

            document.getElementById('modalContent').innerHTML = `
                <div class="space-y-6">
                    <div class="flex items-center gap-4">
                        <div class="avatar w-14 h-14 rounded-full flex items-center justify-center text-lg font-semibold text-white">
                            ${lead.first_name[0]}${lead.last_name[0]}
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold">${lead.first_name} ${lead.last_name}</h3>
                            <p class="text-sm text-zinc-500">${formattedDate}</p>
                            <div class="flex gap-2 mt-1">
                                ${lead.callback_scheduled ? '<span class="inline-flex px-2.5 py-1 rounded-full text-xs font-medium status-callback">Callback Scheduled</span>' : ''}
                                ${lead.signed_up ? '<span class="inline-flex px-2.5 py-1 rounded-full text-xs font-medium status-signed-up">Signed Up</span>' : ''}
                            </div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <div class="grid grid-cols-2 gap-4">
                        ${field('Phone', formatPhone(lead.phone))}
                        ${field('Mobile', formatPhone(lead.mobile_phone))}
                        ${field('Email', lead.email, true)}
                        ${field('Gender', lead.gender)}
                        ${field('Date of Birth', lead.date_of_birth)}
                    </div>

                    <div class="divider"></div>

                    <div class="grid grid-cols-2 gap-4">
                        ${field('Street', lead.street, true)}
                        ${field('City', lead.city)}
                        ${field('State', lead.state)}
                        ${field('Postal Code', lead.postal_code)}
                    </div>

                    <div class="divider"></div>

                    <div class="grid grid-cols-2 gap-4">
                        ${field('Insurance', lead.primary_insurance)}
                        ${field('Med Count', lead.total_med_count)}
                        ${field('Affiliate', lead.list_affiliate_name, true)}
                        ${field('Status', lead.salesforce_status)}
                    </div>
                </div>
            `;

            document.getElementById('leadModal').classList.remove('hidden');
        }

        function updateSignupButton(isSignedUp) {
            const btn = document.getElementById('signupBtn');
            const btnText = document.getElementById('signupBtnText');

            if (isSignedUp) {
                btn.classList.add('btn-signed-up-active');
                btn.classList.remove('btn-secondary');
                btnText.textContent = 'Unmark Signed Up';
            } else {
                btn.classList.remove('btn-signed-up-active');
                btn.classList.add('btn-secondary');
                btnText.textContent = 'Mark as Signed Up';
            }
        }

        async function toggleSignup() {
            if (!currentLeadId) return;

            try {
                const response = await fetch(`${API_BASE}/api/leads/${currentLeadId}/signup`, {
                    method: 'PATCH'
                });
                const data = await response.json();

                // Update the current lead in memory
                if (currentLead) {
                    currentLead.signed_up = data.signed_up;
                    currentLead.signed_up_at = data.signed_up_at;
                }

                // Update the button state
                updateSignupButton(data.signed_up);

                // Refresh the leads list and stats
                loadStats();
                loadLeads();
            } catch (error) {
                console.error('Error toggling signup:', error);
                alert('Error updating lead status');
            }
        }

        function updateCallbackButton(isCallback) {
            const btn = document.getElementById('callbackBtn');
            const btnText = document.getElementById('callbackBtnText');

            if (isCallback) {
                btn.classList.add('btn-callback-active');
                btn.classList.remove('btn-secondary');
                btnText.textContent = 'Unmark Callback';
            } else {
                btn.classList.remove('btn-callback-active');
                btn.classList.add('btn-secondary');
                btnText.textContent = 'Callback Scheduled';
            }
        }

        async function toggleCallback() {
            if (!currentLeadId) return;

            try {
                const response = await fetch(`${API_BASE}/api/leads/${currentLeadId}/callback`, {
                    method: 'PATCH'
                });
                const data = await response.json();

                // Update the current lead in memory
                if (currentLead) {
                    currentLead.callback_scheduled = data.callback_scheduled;
                    currentLead.callback_scheduled_at = data.callback_scheduled_at;
                }

                // Update the button state
                updateCallbackButton(data.callback_scheduled);

                // Refresh the leads list and stats
                loadStats();
                loadLeads();
            } catch (error) {
                console.error('Error toggling callback:', error);
                alert('Error updating lead status');
            }
        }

        function field(label, value, full = false) {
            return `
                <div class="${full ? 'col-span-2' : ''}">
                    <p class="text-xs text-zinc-500 mb-1">${label}</p>
                    <p class="text-sm font-medium">${value || '—'}</p>
                </div>
            `;
        }

        function closeModal() {
            document.getElementById('leadModal').classList.add('hidden');
        }

        function deleteLead() {
            document.getElementById('leadModal').classList.add('hidden');
            document.getElementById('deleteModal').classList.remove('hidden');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
        }

        async function confirmDelete() {
            if (!currentLeadId) return;
            try {
                await fetch(`${API_BASE}/api/leads/${currentLeadId}`, { method: 'DELETE' });
                closeDeleteModal();
                refreshLeads();
            } catch (e) {
                alert('Error deleting lead');
            }
        }

        function handleSearch(e) {
            if (e.key === 'Enter') {
                currentPage = 1;
                loadLeads();
            }
        }

        function refreshLeads() {
            loadStats();
            loadLeads();
        }

        function exportCSV() {
            let url = `${API_BASE}/api/leads/export/csv`;
            if (currentTab === 'signed_up') {
                url += '?signed_up=true';
            }
            window.location.href = url;
        }
    </script>
</body>
</html>
